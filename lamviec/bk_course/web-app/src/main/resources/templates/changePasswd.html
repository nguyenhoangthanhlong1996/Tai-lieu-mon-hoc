<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <th:block th:include="/_head"></th:block>
</head>

<body>
    <th:block th:include="/_header-section"></th:block>

    <!-- Page -->
    <section class="contact-page spad pb-0">
        <div class="container">
            <th:block th:include="/_subMenuLogin"></th:block>
            <div class="row">
                <div class="col-lg-12">
                    <div class="contact-form-warp">
                        <div class="section-title text-white text-left">
                            <h3>Đổi mật khẩu đăng nhập</h3>
                        </div>
                    </div>
                </div>
            </div>
            <form id="frmChangePassword" name="frmChangePassword" method="POST" action="changePasswd"
                th:object="${changePasswordForm}" class="contact-form">
                <div class="row">
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label class="col-md-12" for="passWordLogin">Mật khẩu mới:</label>
                            <div class="col-md-12 inputGroupContainer">
                                <div class="input-group">
                                    <input name="passWordLogin" id="passWordLogin" placeholder="Nhập mật khẩu mới"
                                        class="form-control" type="password" th:field="*{passWordLogin}" required>
                                </div>
                                <span th:if="${#fields.hasErrors('passWordLogin')}" th:errors="*{passWordLogin}" class="error">...</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-4">
                                    <div class="form-group">
                                        <label class="col-md-12" for="rePassWordLogin">Nhập lại mật khẩu mới:</label>
                                        <div class="col-md-12 inputGroupContainer">
                                            <div class="input-group">
                                                <input name="rePassWordLogin" id="rePassWordLogin"
                                                    placeholder="Nhập mật khẩu mới" class="form-control"
                                                    type="password" th:field="*{rePassWordLogin}" required>
                                            </div>
                                            <span th:if="${#fields.hasErrors('rePassWordLogin')}" th:errors="*{rePassWordLogin}" class="error">...</span>
                                        </div>
                                    </div>
                                </div>
                    </div>
                    <div class="row">
                            <div class="col-sm-12" style="text-align: center;">
                                <input type="submit" value="Xác nhận" class="site-btn">
                            </div>
                        </div>
                        <div class="row" id="msgErrors">
                            <span th:if="${errorMessage != null}" th:utext="${errorMessage}" class="error">...</span>
                        </div>
            </form>
        </div>
    </section>
    <!-- Page end -->
    <br />
    <th:block th:include="/_footer-section"></th:block>
    <script>
        $(document).ready(function () {
            //Validate
            $("#frmChangePassword").validate({
                ignore: "not:hidden",
                onfocusout: false,
                onkeyup: false,
                onclick: false,
                rules: {
                    passWordLogin: {
                        required: true,
                        minlength: 8
                    },
                    rePassWordLogin: {
                        required: true,
                        equalTo: "#passWordLogin"
                    }
                },
                messages: {
                    passWordLogin: {
                        required: "Nhập mật khẩu mới",
                        minlength: "Mật khẩu tối thiểu 8 ký tự"
                    },
                    rePassWordLogin: {
                        required: "Nhập lại mật khẩu mới",
                        equalTo: "Nhập lại mật khẩu mới"
                    }
                }
            });
            //end validate
            //submit
            $("#frmChangePassword").submit(function (event) {
                event.preventDefault();
                if (!$("#frmChangePassword").valid()) {
                    return;
                }
                //call ajax
                try {
                    $.ajax({
                        type: "post",
                        url: "/changePasswd",
                        data: $('form[name=frmChangePassword]').serialize(),
                        success: function (response) {
                            if (response.code == "200") {
                                Swal.fire({
                                    type: 'success',
                                    title: 'Thông báo',
                                    text: 'Mật khẩu mới đã cập nhật'
                                });
                            } else {
                                //Show errorMessage
                                var responseMsg = response.msg;
                                if (responseMsg == "errors") {
                                    //Set error messages
                                    $.each(response.data, function (key, value) {
                                        $('input[name=' + key + ']').after('<span class="error">' + value + '</span>');
                                    });
                                    //
                                    Swal.fire({
                                        type: 'error',
                                        title: 'Lỗi đổi mật khẩu',
                                        text: 'Phát sinh lỗi trong quá trình lưu thông tin'
                                    });
                                } else {
                                    Swal.fire({
                                        type: 'error',
                                        title: 'Lỗi lưu thông tin',
                                        text: responseMsg
                                    });
                                }
                            }
                        },
                        error: function () {
                            Swal.fire({
                                type: 'error',
                                title: 'Lỗi lưu thông tin',
                                text: 'Phát sinh lỗi trong quá trình lưu thông tin'
                            });
                        }
                    });
                } catch (err) {
                    console.log(err.message);
                }
            });

        });
    </script>
</body>

</html>